{{/* code-diff shortcode: shows a diff view with red/green highlighting */}}
{{ $title := .Get "title" | default "Diff" }}
{{ $collapsed := eq (.Get "collapsed") "true" }}
{{ $lineCount := len (split .Inner "\n") }}

{{ if $collapsed }}
<details class="code-diff-collapsible">
  <summary class="code-diff-summary">
    <span class="code-diff-summary__title">{{ $title }}</span>
    <span class="code-diff-summary__meta">{{ $lineCount }} lines â€” click to expand</span>
  </summary>
{{ end }}
<div class="code-diff">
  <div class="cd-title">{{ $title }}</div>
  {{ $raw := .Inner }}
  {{ $lines := split $raw "\n" }}
  {{ range $lines }}
    {{ if hasPrefix . "+" }}
      <div class="cd-line cd-add">{{ . }}</div>
    {{ else if hasPrefix . "-" }}
      <div class="cd-line cd-remove">{{ . }}</div>
    {{ else if hasPrefix . "@" }}
      <div class="cd-line" style="color:var(--ds-code-light);font-weight:600">{{ . }}</div>
    {{ else }}
      <div class="cd-line cd-context">{{ . }}</div>
    {{ end }}
  {{ end }}
</div>
{{ if $collapsed }}
</details>
{{ end }}
