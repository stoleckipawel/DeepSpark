{{/* Compile-compare shortcode: two side-by-side compile buttons showing different outputs */}}
{{ $fileA := .Get "fileA" }}
{{ $fileB := .Get "fileB" }}
{{ $labelA := .Get "labelA" | default "Variant A" }}
{{ $labelB := .Get "labelB" | default "Variant B" }}
{{ $deps := .Get "deps" | default "" }}
{{ $lang := .Get "lang" | default "cpp" }}
{{ $resA := .Page.Resources.GetMatch $fileA }}
{{ $resB := .Page.Resources.GetMatch $fileB }}
{{ if and $resA $resB }}
{{/* Build compilable source for A */}}
{{ $srcA := $resA.Content }}
{{ if $deps }}
  {{ $depRes := $.Page.Resources.GetMatch $deps }}
  {{ if $depRes }}
    {{ $incDir := printf "#include \"%s\"" $deps }}
    {{ $srcA = replace $srcA $incDir $depRes.Content }}
  {{ end }}
{{ end }}
{{/* Build compilable source for B */}}
{{ $srcB := $resB.Content }}
{{ if $deps }}
  {{ $depRes := $.Page.Resources.GetMatch $deps }}
  {{ if $depRes }}
    {{ $incDir := printf "#include \"%s\"" $deps }}
    {{ $srcB = replace $srcB $incDir $depRes.Content }}
  {{ end }}
{{ end }}
<div class="compile-compare">
  <div class="cc-header">
    <span class="cc-icon">âš–</span>
    <span class="cc-title">Compare: {{ $labelA }} vs {{ $labelB }}</span>
  </div>
  <div class="cc-panels">
    <div class="cc-panel">
      <div class="cc-panel-title cc-panel-a">{{ $labelA }}</div>
      <details class="code-collapse code-collapse-compact">
        <summary>
          <span class="code-compact-bar">
            <span class="code-compact-icon">ðŸ“„</span>
            <span class="code-compact-name">{{ $fileA }}</span>
            <span class="code-compact-meta">{{ len (split $resA.Content "\n") }} lines</span>
            <span class="code-compact-actions" data-source="{{ $srcA | base64Encode }}">
              <button class="compile-btn-sm" onclick="event.stopPropagation();compileAndRun(this)">â–¶ Run</button>
            </span>
            <span class="code-compact-expand">â–¸ source</span>
          </span>
        </summary>
        {{ highlight $resA.Content $lang "" }}
      </details>
      <pre class="compile-output"></pre>
    </div>
    <div class="cc-panel">
      <div class="cc-panel-title cc-panel-b">{{ $labelB }}</div>
      <details class="code-collapse code-collapse-compact">
        <summary>
          <span class="code-compact-bar">
            <span class="code-compact-icon">ðŸ“„</span>
            <span class="code-compact-name">{{ $fileB }}</span>
            <span class="code-compact-meta">{{ len (split $resB.Content "\n") }} lines</span>
            <span class="code-compact-actions" data-source="{{ $srcB | base64Encode }}">
              <button class="compile-btn-sm" onclick="event.stopPropagation();compileAndRun(this)">â–¶ Run</button>
            </span>
            <span class="code-compact-expand">â–¸ source</span>
          </span>
        </summary>
        {{ highlight $resB.Content $lang "" }}
      </details>
      <pre class="compile-output"></pre>
    </div>
  </div>
</div>
{{ else }}
  {{ if not $resA }}{{ errorf "compile-compare: fileA %q not found" $fileA }}{{ end }}
  {{ if not $resB }}{{ errorf "compile-compare: fileB %q not found" $fileB }}{{ end }}
{{ end }}
