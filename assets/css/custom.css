/* ═══════════════════════════════════════════════════════════════
   UNIFIED COMPONENT CLASSES
   Replaces recurring inline styles across articles.
   Colour comes from --ds-* tokens in schemes/deepspark.css.

   Class-naming conventions:
     ds-*        Shared components (badge, nav, card, power-bar)
     fg-*        Frame Graph article-specific (hoverable)
     diagram-*   Static diagram styles (bars, pipeline, box, etc.)
     widget-*    Interactive widget shared UI (header, btn, body)
     [name]-*    Widget-specific (dag-, topo-, async-, barrier-,
                 alias-, pipe-)
     flow-*      SVG flow-charging system (lg, md, mini, green)
     code-*      Code shortcode styles (diff, collapse, compile)
   ═══════════════════════════════════════════════════════════════ */

/* ── Series navigation banner (top of each article) ──────────── */
.ds-series-nav {
  margin: 0 0 1.5em;
  padding: .7em 1em;
  border-radius: 8px;
  background: rgba(var(--ds-indigo-rgb), .04);
  border: 1px solid rgba(var(--ds-indigo-rgb), .12);
  font-size: .88em;
  line-height: 1.6;
  opacity: .85;
}

/* ── Article prev/next footer navigation ─────────────────────── */
.ds-article-footer {
  margin: 2em 0 0;
  padding: 1em 1.2em;
  border-radius: 10px;
  border: 1px solid rgba(var(--ds-indigo-rgb), .15);
  background: rgba(var(--ds-indigo-rgb), .03);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: .9em;
  gap: 1em;
}
.ds-article-footer a {
  text-decoration: none;
  font-weight: 600;
  transition: color .15s;
}
.ds-article-footer a:hover {
  color: var(--ds-accent);
}

/* ── Badge / pill tag ────────────────────────────────────────── */
.ds-badge {
  display: inline-block;
  font-size: .68em;
  font-weight: 700;
  padding: .15em .55em;
  border-radius: 9px;
  white-space: nowrap;
}
.ds-badge--info    { background: rgba(var(--ds-info-rgb), .1);    color: var(--ds-info-light); }
.ds-badge--code    { background: rgba(var(--ds-code-rgb), .1);    color: var(--ds-code-light); }
.ds-badge--success { background: rgba(var(--ds-success-rgb), .1); color: var(--ds-success); }
.ds-badge--solid-success { background: var(--ds-success); color: #fff; }

.ds-badge--loc {
  font-size: .65em;
  padding: .15em .5em;
}

/* ── Skill-tag pills (about.md timeline) ─────────────────────── */
.ds-tag {
  font-size: .75em;
  padding: .2em .55em;
  border-radius: 5px;
  font-weight: 600;
}
.ds-tag--accent    { border: 1px solid rgba(var(--ds-accent-rgb), .18);    background: rgba(var(--ds-accent-rgb), .06);    color: rgba(var(--ds-accent-rgb), .85); }
.ds-tag--highlight { border: 1px solid rgba(var(--ds-highlight-rgb), .18); background: rgba(var(--ds-highlight-rgb), .06); color: rgba(var(--ds-highlight-rgb), .85); }
.ds-tag--warm      { border: 1px solid rgba(var(--ds-warm-rgb), .18);      background: rgba(var(--ds-warm-rgb), .06);      color: rgba(var(--ds-warm-rgb), .85); }

/* ── Timeline structural helpers (about.md) ──────────────────── */
.tl-entry       { position: relative; margin-bottom: 2.2em; }
.tl-entry:last-child { margin-bottom: 0; }
.tl-dot         { position: absolute; left: -2.9em; top: .15em; width: 1.4em; height: 1.4em; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
.tl-dot-active  { background: linear-gradient(135deg, var(--ds-soft), var(--ds-accent)); }
.tl-dot-past    { background: rgba(var(--ds-accent-rgb), .3); }
.tl-dot-early   { background: rgba(var(--ds-accent-rgb), .2); }
.tl-dot__inner  { width: .5em; height: .5em; border-radius: 50%; background: #fff; }
.tl-company     { font-weight: 800; font-size: 1.08em; }
.tl-role        { font-size: .82em; opacity: .55; margin: .15em 0 .5em; }
.tl-body        { font-size: .92em; line-height: 1.7; }
.tl-tags        { display: flex; flex-wrap: wrap; gap: .4em; margin-top: .6em; }
.badge-current  { font-size: .78em; padding: .18em .6em; border-radius: 5px; background: rgba(var(--ds-highlight-rgb), .12); color: var(--ds-highlight); font-weight: 600; }

/* ── Grid layout utilities ───────────────────────────────────── */
.ds-grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 1em; margin: 1.2em 0; }
.ds-grid-3col { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; }
.ds-grid-4col { display: grid; grid-template-columns: repeat(4, 1fr); gap: .6em; margin: 1.2em 0; }

/* ── Card header / body (comparison panels, info boxes) ──────── */
.ds-card {
  border-radius: 10px;
  overflow: hidden;
}
.ds-card--info    { border: 1.5px solid rgba(var(--ds-info-rgb), .3); }
.ds-card--code    { border: 1.5px solid rgba(var(--ds-code-rgb), .3); }
.ds-card--success { border: 1.5px solid rgba(var(--ds-success-rgb), .3); }
.ds-card--warn    { border: 1.5px solid rgba(var(--ds-warn-rgb), .3); }
.ds-card--danger  { border: 1.5px solid rgba(var(--ds-danger-rgb), .3); }

.ds-card-header {
  padding: .6em .9em;
  font-weight: 800;
  font-size: .95em;
}
.ds-card-header--info    { background: rgba(var(--ds-info-rgb), .08);    border-bottom: 1px solid rgba(var(--ds-info-rgb), .15);    color: var(--ds-info-light); }
.ds-card-header--code    { background: rgba(var(--ds-code-rgb), .08);    border-bottom: 1px solid rgba(var(--ds-code-rgb), .15);    color: var(--ds-code-light); }
.ds-card-header--success { background: rgba(var(--ds-success-rgb), .08); border-bottom: 1px solid rgba(var(--ds-success-rgb), .15); color: var(--ds-success); }
.ds-card-header--warn    { background: rgba(var(--ds-warn-rgb), .08);    border-bottom: 1px solid rgba(var(--ds-warn-rgb), .15);    color: var(--ds-warn); }
.ds-card-header--danger  { background: rgba(var(--ds-danger-rgb), .08);  border-bottom: 1px solid rgba(var(--ds-danger-rgb), .15);  color: var(--ds-danger); }

.ds-card-body {
  padding: .7em .9em;
  font-size: .88em;
  line-height: 1.7;
}

/* ── Callout / tip boxes (left-bordered note) ────────────────── */
.ds-callout {
  margin: 1em 0;
  padding: .7em 1em;
  border-radius: 8px;
  font-size: .92em;
  line-height: 1.6;
  border-left: 4px solid;
}
.ds-callout--info    { border-color: var(--ds-info);    background: rgba(var(--ds-info-rgb), .04); }
.ds-callout--success { border-color: var(--ds-success); background: rgba(var(--ds-success-rgb), .04); }
.ds-callout--warn    { border-color: var(--ds-warn);    background: rgba(var(--ds-warn-rgb), .04); }
.ds-callout--danger  { border-color: var(--ds-danger);  background: rgba(var(--ds-danger-rgb), .04); }

/* ── Muted utility ───────────────────────────────────────────── */
.ds-muted { opacity: .5; }

/* ── MVP timeline progress bar ───────────────────────────────── */
.ds-power-bar {
  height: 8px;
  border-radius: 4px;
  background: rgba(127, 127, 127, .08);
  overflow: hidden;
}
.ds-power-bar__fill {
  height: 100%;
  border-radius: 4px;
}
.ds-power-bar__fill--info    { width: 20%;  background: var(--ds-info); }
.ds-power-bar__fill--v2      { width: 65%;  background: linear-gradient(90deg, var(--ds-info), var(--ds-code)); }
.ds-power-bar__fill--full    { width: 100%; background: linear-gradient(90deg, var(--ds-info), var(--ds-code), var(--ds-success)); }

.ds-power-bar__labels {
  display: flex;
  justify-content: space-between;
  margin-top: .25em;
  font-size: .6em;
  opacity: .4;
  font-weight: 600;
}

/* ── Timeline dot (vertical timelines) ───────────────────────── */
.ds-dot {
  position: absolute;
  width: 2.3em;
  height: 2.3em;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  font-size: .72em;
  color: #fff;
  z-index: 1;
}
.ds-dot--info    { background: var(--ds-info); }
.ds-dot--code    { background: var(--ds-code); }
.ds-dot--success { background: var(--ds-success); }

/* ── MVP card (timeline version cards) ───────────────────────── */
.ds-mvp-card {
  padding: .8em 1em;
  border-radius: 10px;
  transition: all .2s ease;
}
.ds-mvp-card--info {
  border: 1.5px solid rgba(var(--ds-info-rgb), .2);
  background: rgba(var(--ds-info-rgb), .04);
}
.ds-mvp-card--code {
  border: 1.5px solid rgba(var(--ds-code-rgb), .2);
  background: rgba(var(--ds-code-rgb), .04);
}
.ds-mvp-card--success {
  border: 2px solid rgba(var(--ds-success-rgb), .3);
  background: rgba(var(--ds-success-rgb), .04);
}

.ds-mvp-card__title {
  display: flex;
  align-items: baseline;
  gap: .5em;
  margin-bottom: .3em;
}
.ds-mvp-card__title--info    > span:first-child { font-weight: 900; font-size: 1em;   color: var(--ds-info-light); }
.ds-mvp-card__title--code    > span:first-child { font-weight: 900; font-size: 1em;   color: var(--ds-code-light); }
.ds-mvp-card__title--success > span:first-child { font-weight: 900; font-size: 1.05em; color: var(--ds-success); }

.ds-mvp-card__desc {
  font-size: .84em;
  line-height: 1.5;
  opacity: .85;
  margin-bottom: .5em;
}

.ds-mvp-card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: .35em;
  margin-bottom: .6em;
}

/* ── Full-width layout overrides ─────────────────────────────── */

/* Widen the outer page container (theme default: max-w-7xl = 1280px).
   Using a large but finite value so margin:auto still centres the page. */
body {
  max-width: 1800px !important;
}

/* Widen article header (theme default: max-w-prose �? 65ch) */
#single_header {
  max-width: none !important;
}

/* Widen article body text (theme default: max-w-prose �? 65ch) */
.article-content {
  max-width: none !important;
}

/* Widen list-page content area (same constraint as article body) */
section.prose > div.max-w-prose {
  max-width: none !important;
}

/* ── Collapsible code blocks (include-code shortcode) ────────── */

.code-collapse {
  margin: 1em 0;
  border-radius: 0.5rem;
  overflow: hidden;
}

/* The entire summary (label + preview) is one big click target */
.code-collapse > summary {
  cursor: pointer;
  list-style: none;
  position: relative;
  display: block;
}

.code-collapse > summary::-webkit-details-marker {
  display: none;
}

.code-collapse > summary::marker {
  display: none;
  content: "";
}

.code-collapse-label {
  display: flex;
  align-items: center;
  gap: 0.5em;
  padding: 0.5em 1em;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.85em;
  font-weight: 600;
  color: var(--color-neutral-400);
}

.code-collapse-hint {
  font-weight: 400;
  font-size: 0.85em;
  opacity: 0.6;
}

/* Preview body: holds the highlighted code + fade overlay */
.code-preview-body {
  position: relative;
  overflow: hidden;
}

/* Fade overlay at the bottom of the preview */
.code-fade-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 3.5em;
  background: linear-gradient(transparent, var(--color-neutral-800, #1e1e1e));
  pointer-events: none;
}

/* Hover effect — make it obvious the block is clickable */
.code-collapse > summary:hover .code-preview-body {
  outline: 2px solid rgba(var(--ds-info-rgb), 0.4);
  outline-offset: -2px;
  border-radius: 0 0 0.5rem 0.5rem;
}

.code-collapse > summary:hover .code-collapse-label {
  color: var(--ds-info-light);
}

/* When expanded: hide the preview body, show the full code */
.code-collapse[open] > summary .code-preview-body {
  display: none;
}

.code-collapse[open] > summary .code-collapse-hint {
  display: none;
}

.code-collapse[open] > summary .code-collapse-label::after {
  content: "(click to collapse)";
  font-weight: 400;
  font-size: 0.85em;
  opacity: 0.6;
}

/* When expanded, full code body is also clickable to collapse */
.code-collapse[open] > .highlight {
  cursor: pointer;
}

.code-collapse[open] > .highlight:hover {
  outline: 2px solid rgba(var(--ds-danger-rgb), 0.3);
  outline-offset: -2px;
  border-radius: 0 0 0.5rem 0.5rem;
}

/* ── Compact code-block mode ──────────────────────────────── */
.code-collapse-compact {
  margin: .5em 0;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid rgba(var(--ds-code-rgb),.2);
  background: rgba(var(--ds-code-rgb),.04);
}

.code-collapse-compact > summary {
  cursor: pointer;
  list-style: none;
  display: block;
}

.code-collapse-compact > summary::-webkit-details-marker { display: none; }
.code-collapse-compact > summary::marker { display: none; content: ""; }

.code-compact-bar {
  display: flex;
  align-items: center;
  gap: .5em;
  padding: .45em .9em;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: .82em;
  color: var(--color-neutral-400);
  transition: background .15s;
}

.code-collapse-compact > summary:hover .code-compact-bar {
  background: rgba(var(--ds-code-rgb),.08);
}

.code-compact-icon {
  font-size: 1.1em;
  line-height: 1;
}

.code-compact-name {
  font-weight: 700;
  color: var(--color-neutral-200, #e5e5e5);
}

.code-compact-meta {
  opacity: .55;
  font-size: .88em;
  margin-right: auto;
}

.code-compact-expand {
  font-size: .85em;
  opacity: .5;
  transition: opacity .15s;
}

.code-collapse-compact > summary:hover .code-compact-expand {
  opacity: .9;
  color: var(--ds-code-light);
}

.code-collapse-compact[open] .code-compact-expand {
  display: none;
}

.code-compact-actions {
  display: flex;
  gap: .35em;
}

.compile-btn-sm,
.godbolt-btn-sm {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: .78em;
  font-weight: 600;
  padding: .25em .6em;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background .15s, opacity .15s;
}

.compile-btn-sm {
  background: var(--ds-success);
  color: #fff;
}
.compile-btn-sm:hover { background: var(--ds-success-dark); }
.compile-btn-sm:disabled { opacity: .5; cursor: wait; }

.godbolt-btn-sm {
  background: rgba(var(--ds-info-rgb),.15);
  color: var(--ds-info-light);
}
.godbolt-btn-sm:hover { background: rgba(var(--ds-info-rgb),.3); }
.godbolt-btn-sm:disabled { opacity: .5; cursor: wait; }

.code-collapse-compact[open] > .highlight {
  cursor: pointer;
  border-top: 1px solid rgba(var(--ds-code-rgb),.15);
}

.code-collapse-compact[open] > .highlight:hover {
  outline: 2px solid rgba(var(--ds-danger-rgb), 0.3);
  outline-offset: -2px;
}

.code-compact + .compile-output {
  margin-top: 0;
}

/* Light mode gradient */
@media (prefers-color-scheme: light) {
  .code-fade-overlay {
    background: linear-gradient(transparent, var(--color-neutral-100, #f5f5f5));
  }
  .code-compact-name {
    color: var(--color-neutral-700, #374151);
  }
  .code-collapse-compact {
    background: rgba(var(--ds-code-rgb),.03);
  }
}

/* ── Compile & Run buttons / output ──────────────────────────── */
.code-actions {
  display: flex;
  gap: 0.5em;
  margin: -0.5em 0 0 0;
  padding: 0.5em 1em;
}

.compile-btn,
.godbolt-btn {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.8em;
  font-weight: 600;
  padding: 0.4em 1em;
  border: none;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: background 0.15s, opacity 0.15s;
}

.compile-btn {
  background: var(--ds-success);
  color: #fff;
}
.compile-btn:hover:not(:disabled) {
  background: var(--ds-success-dark);
}

.godbolt-btn {
  background: var(--color-neutral-600, #525252);
  color: #fff;
}
.godbolt-btn:hover:not(:disabled) {
  background: var(--color-neutral-500, #737373);
}

.compile-btn:disabled,
.godbolt-btn:disabled {
  opacity: 0.6;
  cursor: wait;
}

/* ── Compilation output — improved visibility ────────────────── */
.compile-output {
  display: none;
  margin: 0.25em 0 1em 0;
  padding: 1em 1.2em;
  background: #0d1117;
  color: #c9d1d9;
  border-radius: 0.5rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.85em;
  line-height: 1.7;
  overflow-x: auto;
  white-space: pre-wrap;
  word-break: break-word;
  border-left: 4px solid var(--ds-success);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  max-height: 600px;
  overflow-y: auto;
}

@media (prefers-color-scheme: light) {
  .compile-output {
    background: #1e1e2e;
    color: #cdd6f4;
  }
}

/* ── Styled diagram replacements for ASCII art ───────────────── */

/* Pipeline: vertical or horizontal multi-stage */
.diagram-pipeline {
  display: flex;
  gap: 0.75em;
  flex-wrap: wrap;
  margin: 1em 0;
}
.diagram-pipeline .dp-stage {
  flex: 1;
  min-width: 150px;
  padding: 0.75em 1em;
  border-radius: 0.5rem;
  border: 2px solid var(--ds-info);
  background: rgba(var(--ds-info-rgb),0.06);
  font-size: 0.82em;
}
:is(.dark,.scheme-congo) .diagram-pipeline .dp-stage {
  background: rgba(var(--ds-info-rgb),0.1);
  border-color: var(--ds-info);
}
.diagram-pipeline .dp-stage .dp-title {
  font-weight: 700;
  font-family: ui-monospace, SFMono-Regular, monospace;
  margin-bottom: 0.3em;
  color: var(--ds-info-light);
}
.diagram-pipeline .dp-stage ul {
  margin: 0;
  padding-left: 1.2em;
  line-height: 1.6;
}

/* Box: bordered container with title */
.diagram-box {
  margin: 1em 0;
  border: 2px solid var(--color-neutral-300, #d4d4d4);
  border-radius: 0.5rem;
  overflow: hidden;
  font-size: 0.85em;
}
:is(.dark,.scheme-congo) .diagram-box {
  border-color: var(--color-neutral-600);
}
.diagram-box .db-title {
  padding: 0.5em 1em;
  font-weight: 700;
  font-family: ui-monospace, SFMono-Regular, monospace;
  background: var(--color-neutral-100, #f5f5f5);
  border-bottom: 2px solid var(--color-neutral-300, #d4d4d4);
}
:is(.dark,.scheme-congo) .diagram-box .db-title {
  background: var(--color-neutral-800);
  border-color: var(--color-neutral-600);
}
.diagram-box .db-body {
  padding: 0.75em 1em;
  line-height: 1.7;
}

/* Bar chart: horizontal bars with labels */
.diagram-bars {
  margin: 1em 0;
  display: grid;
  grid-template-columns: 120px 1fr 60px;
  gap: 0.4em 0.75em;
  align-items: center;
  font-size: 0.82em;
  font-family: ui-monospace, SFMono-Regular, monospace;
}
.diagram-bars .db-label {
  font-weight: 600;
  text-align: right;
}
.diagram-bars .db-bar {
  height: 20px;
  border-radius: 3px;
  background: var(--ds-info);
}
.diagram-bars .db-bar.db-warn { background: var(--ds-warn); }
.diagram-bars .db-bar.db-danger { background: var(--ds-danger); }
.diagram-bars .db-val {
  font-size: 0.85em;
  opacity: 0.7;
}

/* Limitations / feature box (for RDG limitations, etc.) */
.diagram-limits {
  margin: 1em 0;
  border: 2px solid var(--ds-danger);
  border-radius: 0.5rem;
  overflow: hidden;
  font-size: 0.85em;
}
.diagram-limits .dl-title {
  padding: 0.4em 1em;
  font-weight: 700;
  background: rgba(var(--ds-danger-rgb),.08);
  border-bottom: 1px solid rgba(var(--ds-danger-rgb),.2);
  color: var(--ds-danger);
  font-family: ui-monospace, SFMono-Regular, monospace;
}
.diagram-limits .dl-item {
  padding: 0.45em 1em;
  border-bottom: 1px solid var(--color-neutral-200, #e5e5e5);
  line-height: 1.6;
}
:is(.dark,.scheme-congo) .diagram-limits .dl-item {
  border-color: var(--color-neutral-800);
}
.diagram-limits .dl-item:last-child { border-bottom: none; }
.diagram-limits .dl-x {
  color: var(--ds-danger);
  font-weight: 700;
  margin-right: 0.4em;
}

/* Steps / walkthrough */
.diagram-steps {
  margin: 1em 0;
  font-size: 0.82em;
}
.diagram-steps .ds-step {
  display: flex;
  gap: 0.75em;
  padding: 0.6em 0;
  border-bottom: 1px dashed var(--color-neutral-300, #d4d4d4);
  line-height: 1.6;
}
:is(.dark,.scheme-congo) .diagram-steps .ds-step {
  border-color: var(--color-neutral-700);
}
.diagram-steps .ds-step:last-child { border-bottom: none; }
.diagram-steps .ds-num {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--ds-info);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.85em;
  flex-shrink: 0;
  margin-top: 1px;
}

/* Code-diff shortcode — styled to match .highlight-wrapper / Chroma */
.code-diff {
  margin: 1.7142857em 0;      /* matches .highlight-wrapper */
  border-radius: 0.375rem;    /* rounded-md, same as .highlight-wrapper */
  overflow: hidden;
  box-shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px -1px rgba(0,0,0,.1); /* shadow, same as .highlight-wrapper */
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.82em;
  line-height: 1.7;
  background: #0d1117;        /* matches .chroma bg */
  color: #D4D4D4;
}
.code-diff .cd-title {
  padding: 0.5rem 1rem;
  font-weight: 600;
  background: #0d1117;
  border-bottom: 1px solid #262626;
  font-size: 0.95em;
}
.code-diff .cd-line {
  display: flex;
  white-space: pre;
  border-left: 3px solid transparent;
  padding: 0.05em 1em 0.05em 0;
}
.code-diff .cd-gutter {
  flex-shrink: 0;
  width: 2em;
  text-align: center;
  user-select: none;
  opacity: .5;
  color: inherit;
}
.code-diff .cd-code {
  flex: 1;
  min-width: 0;
  padding-left: .4em;
}
.code-diff .cd-add {
  background: rgba(var(--ds-success-rgb),.22);
  border-left-color: var(--ds-success);
}
.code-diff .cd-add .cd-gutter {
  color: var(--ds-success);
  opacity: .8;
}
.code-diff .cd-remove {
  background: rgba(var(--ds-danger-rgb),.18);
  border-left-color: var(--ds-danger);
}
.code-diff .cd-remove .cd-gutter {
  color: var(--ds-danger);
  opacity: .8;
}
.code-diff .cd-context {
  opacity: 0.35;
}

/* ── Diff syntax highlighting (VS Dark C++ palette) ── */
.code-diff .cd-code { color: #D4D4D4; }           /* base text */
.code-diff .cd-kw   { color: #569CD6; }           /* keywords: if, return, class, const */
.code-diff .cd-type { color: #4EC9B0; }           /* types: void, int, uint32_t, bool */
.code-diff .cd-str  { color: #CE9178; }           /* string literals */
.code-diff .cd-num  { color: #B5CEA8; }           /* numeric literals */
.code-diff .cd-cmt  { color: #6A9955; font-style: italic; }  /* comments */
.code-diff .cd-fn   { color: #DCDCAA; }           /* function/method calls */
.code-diff .cd-member { color: #DCDCAA; }         /* member access: .name / ->name */
.code-diff .cd-prep { color: #C586C0; }           /* preprocessor: #include, #define */
.code-diff .cd-op   { color: #D4D4D4; }           /* operators, punctuation, brackets */

/* Collapsible code-diff wrapper — matches .highlight-wrapper */
.code-diff-collapsible {
  margin: 1.7142857em 0;
  border-radius: 0.375rem;
  overflow: hidden;
  box-shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px -1px rgba(0,0,0,.1);
}
.code-diff-collapsible > summary {
  cursor: pointer;
  list-style: none;
  display: flex;
  align-items: center;
  gap: .6em;
  padding: .55em 1em;
  background: #0d1117;
  color: #e6edf3;
  font-family: ui-monospace, SFMono-Regular, monospace;
  font-size: .82em;
  font-weight: 600;
  transition: background .15s;
}
.code-diff-collapsible > summary::-webkit-details-marker { display: none; }
.code-diff-collapsible > summary::marker { display: none; content: ""; }
.code-diff-collapsible > summary::before {
  content: '▶';
  font-size: .7em;
  transition: transform .2s;
}
.code-diff-collapsible[open] > summary::before {
  transform: rotate(90deg);
}
.code-diff-collapsible > summary:hover {
  background: #161b22;
}
.code-diff-summary__title { flex: 1; }
.code-diff-summary__meta {
  font-weight: 400;
  font-size: .88em;
  opacity: .5;
}
.code-diff-collapsible .code-diff {
  margin: 0;
  border-radius: 0;
}
.code-diff-collapsible .cd-title {
  display: none; /* title shown in summary instead */
}

/* Feature comparison table */
.diagram-ftable {
  margin: 1em 0;
  border: 2px solid var(--color-neutral-300, #d4d4d4);
  border-radius: 0.5rem;
  overflow: hidden;
  font-size: 0.82em;
}
:is(.dark,.scheme-congo) .diagram-ftable {
  border-color: var(--color-neutral-600);
}
.diagram-ftable table {
  width: 100%;
  border-collapse: collapse;
}
.diagram-ftable th {
  padding: 0.5em 0.8em;
  text-align: left;
  font-weight: 700;
  font-family: ui-monospace, SFMono-Regular, monospace;
  background: var(--color-neutral-100, #f5f5f5);
  border-bottom: 2px solid var(--color-neutral-300, #d4d4d4);
}
:is(.dark,.scheme-congo) .diagram-ftable th {
  background: var(--color-neutral-800);
  border-color: var(--color-neutral-600);
}
.diagram-ftable td {
  padding: 0.4em 0.8em;
  border-bottom: 1px solid var(--color-neutral-200, #e5e5e5);
}
:is(.dark,.scheme-congo) .diagram-ftable td {
  border-color: var(--color-neutral-800);
}
.diagram-ftable tr:last-child td { border-bottom: none; }

/* Two-phase diagram (Declaration/Compile/Execution) */
.diagram-phases {
  display: flex;
  gap: 0.5em;
  margin: 1em 0;
  flex-wrap: wrap;
  font-size: 0.82em;
}
.diagram-phases .dph-col {
  flex: 1;
  min-width: 160px;
  border: 2px solid var(--color-neutral-300, #d4d4d4);
  border-radius: 0.5rem;
  overflow: hidden;
}
:is(.dark,.scheme-congo) .diagram-phases .dph-col {
  border-color: var(--color-neutral-600);
}
.diagram-phases .dph-title {
  padding: 0.4em 0.7em;
  font-weight: 700;
  font-family: ui-monospace, SFMono-Regular, monospace;
  background: var(--color-neutral-100, #f5f5f5);
  border-bottom: 1px solid var(--color-neutral-300, #d4d4d4);
  font-size: 0.95em;
}
:is(.dark,.scheme-congo) .diagram-phases .dph-title {
  background: var(--color-neutral-800);
  border-color: var(--color-neutral-600);
}
.diagram-phases .dph-body {
  padding: 0.5em 0.7em;
  line-height: 1.7;
}

/* Inline UE5 macro visualization */
.diagram-macro {
  margin: 1em 0;
  display: flex;
  gap: 0.75em;
  align-items: center;
  flex-wrap: wrap;
  font-size: 0.82em;
}
.diagram-macro .dm-code {
  padding: 0.5em 0.8em;
  border-radius: 0.5rem;
  background: var(--color-neutral-100, #f5f5f5);
  border: 2px solid var(--color-neutral-300, #d4d4d4);
  font-family: ui-monospace, SFMono-Regular, monospace;
  line-height: 1.7;
  font-weight: 500;
}
:is(.dark,.scheme-congo) .diagram-macro .dm-code {
  background: var(--color-neutral-800);
  border-color: var(--color-neutral-600);
}
.diagram-macro .dm-arrow {
  font-size: 1.6em;
  color: var(--ds-info-light);
}
.diagram-macro .dm-result {
  padding: 0.5em 0.8em;
  border-radius: 0.5rem;
  border: 2px solid var(--ds-info);
  background: rgba(var(--ds-info-rgb),.08);
  font-family: ui-monospace, SFMono-Regular, monospace;
  line-height: 1.7;
}

/* ── Shimmer animation (used on landing + about hero borders) ── */
@keyframes shimmer {
  0%   { background-position: -200% center; }
  100% { background-position: 200% center; }
}

/* ── Interactive widget chrome ── */
/* Outer container — subtle card with hover awareness */
.interactive-widget{position:relative;margin:1.5em 0;border-radius:.75rem;overflow:hidden;background:var(--color-neutral-50,#fafafa);border:1px solid transparent;transition:border-color .3s,box-shadow .3s}
.interactive-widget:hover{border-color:transparent;box-shadow:none}
:is(.dark,.scheme-congo) .interactive-widget{background:var(--color-neutral-800,#262626)}
:is(.dark,.scheme-congo) .interactive-widget:hover{border-color:transparent;box-shadow:none}

/* Tiny corner hint — signals interactivity without shouting */
.interactive-widget::after{content:"interactive";position:absolute;top:.45em;right:.55em;font-size:.56em;font-weight:500;letter-spacing:.04em;text-transform:uppercase;color:var(--color-neutral-400,#9ca3af);opacity:.55;pointer-events:none;transition:opacity .3s}
:is(.dark,.scheme-congo) .interactive-widget::after{color:var(--color-neutral-500)}
.interactive-widget:hover::after{opacity:0}

/* Header — removed (titles are gone; only body remains) */
.widget-header{display:none}
.widget-body{padding:.75em .75em .6em}
.widget-info{font-family:ui-monospace,SFMono-Regular,monospace;font-size:.78em;margin:.35em 0;line-height:1.7;opacity:.75}

/* Toolbar — single subtle row beneath content */
.widget-toolbar{display:flex;align-items:center;justify-content:space-between;gap:.5em;flex-wrap:wrap;margin-top:.5em;padding-top:.5em;border-top:1px solid color-mix(in srgb,currentColor 8%,transparent)}
.widget-toolbar-left{display:flex;align-items:center;gap:.35em;flex-wrap:wrap}
.widget-toolbar-right{display:flex;align-items:center;gap:.4em;flex-wrap:wrap}

/* ── Shared interactable pulse ── */
@keyframes interact-pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}

/* Pills — ghost-style labels that don't scream */
.widget-pill{font-size:.72em;padding:.25em .65em;border:1px solid var(--color-neutral-300,#d1d5db);border-radius:999px;background:transparent;cursor:pointer;color:var(--color-neutral-500,#6b7280);font-weight:500;transition:all .15s;line-height:1.3}
.widget-pill:hover{color:var(--color-neutral-700,#374151);border-color:var(--color-neutral-400)}
:is(.dark,.scheme-congo) .widget-pill{border-color:var(--color-neutral-600);color:var(--color-neutral-400)}
:is(.dark,.scheme-congo) .widget-pill:hover{color:var(--color-neutral-200);border-color:var(--color-neutral-500)}

/* Legacy .widget-btn kept for action buttons (Reset, Next) */
.widget-btn{font-size:.72em;padding:.25em .7em;border:1px solid var(--color-neutral-300,#d1d5db);border-radius:.375rem;background:transparent;cursor:pointer;color:var(--color-neutral-600,#4b5563);font-weight:500;transition:all .15s;line-height:1.3}
.widget-btn:hover{color:var(--color-neutral-800);border-color:var(--color-neutral-400)}
:is(.dark,.scheme-congo) .widget-btn{border-color:var(--color-neutral-600);color:var(--color-neutral-400)}
:is(.dark,.scheme-congo) .widget-btn:hover{color:var(--color-neutral-200);border-color:var(--color-neutral-500)}

/* Primary action button — continuous pulse draws the eye */
.widget-btn-primary{background:var(--ds-info)!important;color:#fff!important;border-color:var(--ds-info)!important;font-weight:600!important;border-radius:.375rem;animation:interact-pulse 1.4s ease-in-out infinite}
.widget-btn-primary:hover{filter:brightness(1.15);animation:none}
.widget-btn-primary:disabled{opacity:.4;cursor:default;filter:none;animation:none}
.widget-btn-row{display:flex;gap:.5em;align-items:center}


/* ── Card hover lift effect ── */
.fg-hoverable {
  transition: transform .22s ease, box-shadow .22s ease;
}
.fg-hoverable:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,.1);
}
:is(.dark,.scheme-congo) .fg-hoverable:hover {
  box-shadow: 0 6px 20px rgba(0,0,0,.25);
}

/* ── Mobile responsive overrides ──────────────── */
@media (max-width: 768px) {
  /* Diagram bars: stack into 2 columns on small screens */
  .diagram-bars {
    grid-template-columns: 80px 1fr 1fr 1fr !important;
    font-size: .7em !important;
    gap: .2em .3em !important;
  }
  /* Pipeline steps */
  .diagram-pipeline {
    flex-wrap: wrap;
  }
  /* Boxes */
  .diagram-box {
    font-size: .9em;
  }
  /* Tables: horizontal scroll */
  .prose table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  /* Code blocks */
  pre {
    font-size: .8em !important;
  }
}

@media (max-width: 500px) {
  .diagram-bars {
    grid-template-columns: 60px 1fr 1fr 1fr !important;
    font-size: .65em !important;
  }
  .diagram-box {
    font-size: .82em;
    padding: .6em;
  }
}

/* ═══════════════════════════════════════════════════════════
   FLOW CHARGING SYSTEM
   Tokens → schemes/deepspark.css (--ds-flow-*)
   Size   dash:gap  offset  use-case
   lg     14  34    –48     DAG / pipeline / big graph edges
   md      8  20    –28     decision-tree / fence arrows
   sm      5  12    –17     inline decorative arrows / minimap
   ═══════════════════════════════════════════════════════════ */

@keyframes flow-lg { to { stroke-dashoffset: -48 } }
@keyframes flow-md { to { stroke-dashoffset: -28 } }
@keyframes flow-sm { to { stroke-dashoffset: -17 } }

/* Base — every flow overlay needs this */
.flow {
  pointer-events: none;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: var(--ds-flow-opacity, .3);
  stroke: var(--ds-flow, #93c5fd);
}

/* Size variants */
.flow-lg   { stroke-width: 2;   stroke-dasharray: 14 34; animation: flow-lg var(--ds-flow-speed, 3s) linear infinite }
.flow-md   { stroke-width: 2;   stroke-dasharray: 8 20;  animation: flow-md var(--ds-flow-speed, 3s) linear infinite }
.flow-mini { stroke-width: 1.2; stroke-dasharray: 5 12;  animation: flow-sm 2.8s linear infinite }

/* Color variants (default is blue via .flow) */
.flow-green   { stroke: var(--ds-flow-ok, #4ade80) }

/* Speed modifiers — stagger identical edges for visual variety */
.flow-d1 { animation-duration: 2.4s }
.flow-d2 { animation-duration: 2.8s }
.flow-d3 { animation-duration: 1.6s }
.flow-d4 { animation-duration: 3.2s }
.flow-d5 { animation-duration: 2s }
.flow-d6 { animation-duration: 2.6s }
.flow-d7 { animation-duration: 1.5s }
.flow-d8 { animation-duration: 1.8s }

/* ═══════════════════════════════════════════════════════════════════
   Global VS Dark C++ palette — override Chroma github-dark so that
   full-source blocks and code-diffs look identical.
   ═══════════════════════════════════════════════════════════════════ */
html.dark {
  /* Base foreground */
  .chroma { color: #D4D4D4; background-color: #0d1117; }

  /* Keywords → blue */
  .chroma .k,
  .chroma .kd,
  .chroma .kn,
  .chroma .kr,
  .chroma .kt { color: #569CD6; font-weight: normal; }

  /* Keyword constants (true, false, nullptr) → blue */
  .chroma .kc,
  .chroma .kp { color: #569CD6; }

  /* Types / classes → teal */
  .chroma .nc,
  .chroma .no { color: #4EC9B0; font-weight: normal; }

  /* Functions → yellow */
  .chroma .nf,
  .chroma .fm { color: #DCDCAA; font-weight: normal; }

  /* Decorators → purple (matches preprocessor feel) */
  .chroma .nd { color: #C586C0; font-weight: normal; }

  /* Namespace → teal */
  .chroma .nn { color: #4EC9B0; }

  /* Variables → light blue */
  .chroma .nv,
  .chroma .vc,
  .chroma .vg,
  .chroma .vi,
  .chroma .vm { color: #9CDCFE; }

  /* Entity / builtins */
  .chroma .ni { color: #4EC9B0; }
  .chroma .nb,
  .chroma .bp { color: #DCDCAA; }

  /* Labels */
  .chroma .nl { color: #9CDCFE; font-weight: normal; }

  /* Properties */
  .chroma .py { color: #9CDCFE; }

  /* Tags (mostly irrelevant for C++) */
  .chroma .nt { color: #569CD6; }

  /* Strings → warm orange */
  .chroma .s,
  .chroma .sa,
  .chroma .sb,
  .chroma .sc,
  .chroma .dl,
  .chroma .sd,
  .chroma .s2,
  .chroma .se,
  .chroma .sh,
  .chroma .si,
  .chroma .sx,
  .chroma .sr,
  .chroma .s1,
  .chroma .ss { color: #CE9178; }

  /* Numbers → light green */
  .chroma .l,
  .chroma .ld,
  .chroma .m,
  .chroma .mb,
  .chroma .mf,
  .chroma .mh,
  .chroma .mi,
  .chroma .il,
  .chroma .mo { color: #B5CEA8; }

  /* Operators → light gray (not bold) */
  .chroma .o,
  .chroma .ow { color: #D4D4D4; font-weight: normal; }

  /* Punctuation */
  .chroma .p { color: #D4D4D4; }

  /* Comments → green italic */
  .chroma .c,
  .chroma .ch,
  .chroma .cm,
  .chroma .c1,
  .chroma .cs { color: #6A9955; font-style: italic; font-weight: normal; }

  /* Preprocessor → purple */
  .chroma .cp,
  .chroma .cpf { color: #C586C0; font-weight: normal; font-style: normal; }

  /* Error */
  .chroma .err { color: #F44747; }

  /* Generic diff (if Hugo ever renders inline diffs) */
  .chroma .gd { color: #CE9178; background-color: rgba(244,71,71,.15); }
  .chroma .gi { color: #B5CEA8; background-color: rgba(78,201,176,.15); }
}
